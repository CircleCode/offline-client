<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE bindings>
<bindings id="documentBindings"
    xmlns="http://www.mozilla.org/xbl"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
    
    <binding id="document">
        <!--<ressources>
                <stylesheet src="chrome://dcpoffline/skin/document.css"/>
            </ressources>-->
        
        <implementation>
            <property
                name="initid"
                readonly="true">
                <getter><![CDATA[
                    Components.utils.import("resource://modules/logger.jsm");
                    logConsole("accessing initid for document ", this.tagName);
                    if(this.doc){
                        return this.doc.getProperty('initid');
                    } else {
                        return this.getAttribute('initid');
                    }
                ]]></getter>
            </property>
            <!-- mode: "edit" or "view", default is "view" -->
            <property
                name="mode"
                readonly="true">
                <getter><![CDATA[
                    if(this.hasAttribute('mode')){
                        var mode = this.getAttribute('mode');
                        if( (mode != 'view') && (mode != 'edit') ){
                            this.setAttribute('mode', 'view');
                            mode = 'view';
                        }
                        return mode;
                    }
                    return 'view';
                ]]></getter>
            </property>
            <property
                name="localDocument"
                readonly="true">
                <getter><![CDATA[
                    return this.doc;
                ]]></getter>
            </property>
            <method name="getValue">
                <parameter name="attrid"/>
                <body><![CDATA[
                    return this.doc.getvalue({attrid: attrid});
                ]]></body>
            </method>
            <method name="getProperty">
                <parameter name="propertyid"/>
                <body><![CDATA[
                    return this.doc.getProperty({propertyid: propertyid});
                ]]></body>
            </method>
            <method name="save">
                <body><![CDATA[
                    //FIXME
                    return true;
                ]]></body>
            </method>
            <constructor><![CDATA[
                Components.utils.import("resource://modules/logger.jsm");
                logConsole("<--------- entering document [" + this.initid + "] constructor");
                try{
                    Components.utils.import("resource://modules/docManager.jsm");
                    this.doc = docManager.getLocalDocument({initid : this.initid});
                    //XXX: register as a render
                    return true;
                } catch(e){
                    logError(e, "document document [" + this.initid + "] constructor");
                    throw(e);
                }
                logConsole("leaving document [" + this.initid + "] constructor --------->");
            ]]></constructor>
            <destructor><![CDATA[
                try{
                    //TODO: unregister as a render
                    return true;
                } catch(e){
                    logConsole(e);
                }
            ]]></destructor>
        </implementation>
        <!--
            <handlers>

            </handlers>
            -->
    </binding>
    
</bindings>