<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE bindings>
<bindings id="menuBindings"
    xmlns="http://www.mozilla.org/xbl"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:xbl="http://www.mozilla.org/xbl">
    
    <binding id="doc-main-menu">
        <!--<ressources/>-->
        
        <content>
                <xul:hbox anonid="document-toolbar" flex="1">
                    
                    <xul:button anonid="document-toolbar-system-save"
                        label="Sauver"
                        tooltiptext="Sauver">
                    </xul:button>
                    
                    <xul:button
                        anonid="document-toolbar-system-edit"
                        label="Modifier"
                        tooltiptext="Modifier">
                    </xul:button>
                    
                    <xul:splitter anonid="document-toolbar-system-splitter"/>
                    
                    <xul:button
                        label="document.toolbar.properties;"
                        oncommand="alert('open properties');">
                    </xul:button>
                    
                    <xul:splitter/>
                    
                    <children/>
                    
                    <xul:spacer flex="1"/>
                    
                    <xul:button
                        label="close"
                        icon="close">
                    </xul:button>
                    
                </xul:hbox>
        </content>
        
        <implementation>
            <property
                name="localDocument"
                readonly="true"
                onget="return this.doc;"/>
                
            <method name="getDocumentNode">
                <body><![CDATA[
                    if(! this.documentNode){
                        Components.utils.import("resource://modules/domUtils.jsm");
                        this.documentNode = domUtils.getParentByTagName(this, 'dcpDocument');
                    }
                    return this.documentNode
                ]]></body>
            </method>
            
            <method name="getChild">
                <parameter name="aChildName"/>
                <body><![CDATA[
                      return document.getAnonymousElementByAttribute(this, "anonid", aChildName);
                ]]></body>
            </method>
            <constructor><![CDATA[
                this.doc = this.getDocumentNode().localDocument;
                var flex = this.getAttribute('flex') || 1;
                this.setAttribute('flex', flex);
                
                var mode = documentNode.mode;
                
                if(mode === 'edit'){
                    this.getChild('document-toolbar-system-edit').collapsed = true;
                } else {
                    this.getChild('document-toolbar-system-save').collapsed = true;
                }
            ]]></constructor>
        </implementation>
        
        <handlers>
            <handler event="click"  button="0"><![CDATA[
            switch(event.originalTarget){
                case this.getChild('document-toolbar-system-edit') :
                    this.documentNode.switchMode('edit');
                    break;
                case this.getChild('document-toolbar-system-close') :
                    this.getDocumentNode().close();
                    break;
                case this.getChild('document-toolbar-system-close') :
                    this.getDocumentNode().save();
                    break;
            }
            ]]></handler>
        </handlers>
    </binding>
    
</bindings>